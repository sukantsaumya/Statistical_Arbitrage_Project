<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Backtest Results — {{ pair }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="app-bg text-light">
  <nav class="navbar navbar-dark bg-dark shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="{{ url_for('index') }}">Results</a>
      <div class="d-none d-md-block">
        <a class="link-light" href="https://github.com/sukantsaumya/Statistical_Arbitrage_Project" target="_blank">Repo</a>
      </div>
    </div>
  </nav>

  <main class="container py-5">
    <div class="row g-4">

      <div class="col-12">
        <div class="card card-dark p-4">
          <div class="d-flex justify-content-between align-items-start flex-column flex-md-row gap-3">
            <div>
              <h2 class="mb-1">Backtest Results</h2>
              <p class="mb-0 text-muted small">Pair: <strong>{{ pair }}</strong></p>
              <p class="mb-0 text-muted small">Period: <strong>{{ start_date }} → {{ end_date }}</strong></p>
            </div>
            <div class="text-md-end">
              <a href="{{ url_for('download_results', filename=export_csv) }}" class="btn btn-outline-light btn-sm me-2">Download CSV</a>
              <a href="{{ url_for('index') }}" class="btn btn-primary btn-sm">Run Another Test</a>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card card-dark p-4">
          <h5 class="card-title">Pair Statistics</h5>
          <div class="row">
            <div class="col-6 mb-2"><small class="text-muted">Correlation</small><div class="metric-value">{{ "%.3f"|format(best_pair_stats.correlation) }}</div></div>
            <div class="col-6 mb-2"><small class="text-muted">Coint P-Value</small><div class="metric-value">{{ "%.4f"|format(best_pair_stats.pvalue) }}</div></div>
            <div class="col-6 mb-2"><small class="text-muted">Half-Life</small><div class="metric-value">{{ "%.1f"|format(best_pair_stats.half_life) }} days</div></div>
            <div class="col-6 mb-2"><small class="text-muted">Hedge Ratio</small><div class="metric-value">{{ "%.3f"|format(best_pair_stats.hedge_ratio) }}</div></div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card card-dark p-4">
          <h5 class="card-title">Performance Metrics</h5>
          <div class="row">
            <div class="col-6 mb-2"><small class="text-muted">Total Return</small><div class="metric-value">{{ "%.2f%%"|format(metrics.total_return * 100) }}</div></div>
            <div class="col-6 mb-2"><small class="text-muted">Sharpe Ratio</small><div class="metric-value">{{ "%.2f"|format(metrics.sharpe_ratio) }}</div></div>
            <div class="col-6 mb-2"><small class="text-muted">Max Drawdown</small><div class="metric-value">{{ "%.2f%%"|format(metrics.max_drawdown * 100) }}</div></div>
            <div class="col-6 mb-2"><small class="text-muted">Win Rate</small><div class="metric-value">{{ "%.1f%%"|format(metrics.win_rate * 100) }}</div></div>
          </div>
        </div>
      </div>

      <div class="col-12">
        <div class="card card-dark p-4">
          <h5 class="card-title">Performance Dashboard</h5>
          <div class="ratio ratio-16x9">
            <img src="{{ url_for('static', filename='plots/' + plot_image) }}" class="img-fluid rounded" alt="Performance Plot">
          </div>
        </div>
      </div>

      <div class="col-12">
        <div class="card card-dark p-4">
          <h5 class="card-title">Trade Log (recent)</h5>
          {% if trades and trades|length > 0 %}
            <div class="table-responsive">
              <table class="table table-dark table-striped align-middle mb-0">
                <thead>
                  <tr>
                    <th>Date</th><th>Side</th><th>Entry Price</th><th>Exit Price</th><th>P&L</th>
                  </tr>
                </thead>
                <tbody>
                  {% for t in trades[-10:]|reverse %}
                    <tr>
                      <td>{{ t.date }}</td>
                      <td>{{ t.side }}</td>
                      <td>{{ "%.2f"|format(t.entry_price) }}</td>
                      <td>{{ "%.2f"|format(t.exit_price) }}</td>
                      <td>{{ "%.2f"|format(t.pnl) }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <p class="text-muted small mb-0">No trades were executed in the backtest period.</p>
          {% endif %}
        </div>
      </div>

    </div>
  </main>

  <footer class="text-center py-3 text-muted small">
    © {{ current_year }} Sukant Saumya — Statistical Arbitrage Project
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
