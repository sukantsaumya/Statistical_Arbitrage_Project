{% extends "base.html" %}
{% block title %}Results for {{ pair }}{% endblock %}

{% block head_scripts %}
    {{ plot_html|safe }}
{% endblock %}

{% block content %}
<div class="results-header">
    <h2>Backtest Results for Pair: <strong>{{ pair }}</strong></h2>
</div>

<div class="card">
    <h3>Performance Metrics</h3>
    <div class="metrics-grid">
        <div class="metric-card">
            <h3>Total Return</h3>
            <p class="value {% if metrics.total_return > 0 %}positive{% else %}negative{% endif %}">{{ "%.2f"|format(metrics.total_return * 100) }}%</p>
        </div>
        <div class="metric-card">
            <h3>Sharpe Ratio</h3>
            <p class="value {% if metrics.sharpe_ratio > 1 %}positive{% else %}negative{% endif %}">{{ "%.2f"|format(metrics.sharpe_ratio) }}</p>
        </div>
        <div class="metric-card">
            <h3>Max Drawdown</h3>
            <p class="value negative">{{ "%.2f"|format(metrics.max_drawdown * 100) }}%</p>
        </div>
        <div class="metric-card">
            <h3>Annualized Return</h3>
            <p class="value {% if metrics.annualized_return > 0 %}positive{% else %}negative{% endif %}">{{ "%.2f"|format(metrics.annualized_return * 100) }}%</p>
        </div>
    </div>
</div>

<div class="card">
    <h3>Performance Dashboard</h3>
    <div id="plot-div">
        </div>
</div>

<div style="text-align: center;">
    <a href="{{ url_for('index') }}" class="btn-primary" style="text-decoration: none; display: inline-block; width: auto; padding: 1rem 2rem;">Run Another Backtest</a>
</div>
<div class="card">
    <h3>Download Detailed Report</h3>
    <a href="{{ url_for('serve_report', filename=report_filename) }}" target="_blank" class="btn-primary" style="text-decoration: none; text-align: center;">View Full Report</a>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var plotlyFigure = document.querySelector('.plotly-graph-div');
        if (plotlyFigure) {
            document.getElementById('plot-div').appendChild(plotlyFigure);
        }
    });
</script>
{% endblock %}